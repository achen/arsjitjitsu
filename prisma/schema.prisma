// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

model User {
  id           String           @id @default(uuid())
  email        String           @unique
  passwordHash String           @map("password_hash")
  name         String
  belt         String           @default("white")
  isAdmin      Boolean          @default(false) @map("is_admin")
  createdAt    DateTime         @default(now()) @map("created_at")
  updatedAt    DateTime         @updatedAt @map("updated_at")
  ratings      UserRating[]
  notes        TechniqueNote[]
  bookmarks    VideoBookmark[]

  @@map("users")
}

model Technique {
  id          String            @id @default(uuid())
  name        String
  position    String
  type        String
  description String?
  giType      String            @default("both") @map("gi_type")
  createdAt   DateTime          @default(now()) @map("created_at")
  ratings     UserRating[]
  videos      TechniqueVideo[]
  notes       TechniqueNote[]

  @@index([position])
  @@index([type])
  @@map("techniques")
}

model TechniqueVideo {
  id          String          @id @default(uuid())
  techniqueId String          @map("technique_id")
  title       String
  url         String
  instructor  String?
  duration    String?
  createdAt   DateTime        @default(now()) @map("created_at")
  technique   Technique       @relation(fields: [techniqueId], references: [id], onDelete: Cascade)
  bookmarks   VideoBookmark[]

  @@index([techniqueId])
  @@map("technique_videos")
}

model VideoBookmark {
  id        String         @id @default(uuid())
  userId    String         @map("user_id")
  videoId   String         @map("video_id")
  createdAt DateTime       @default(now()) @map("created_at")
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  video     TechniqueVideo @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@unique([userId, videoId])
  @@index([userId])
  @@index([videoId])
  @@map("video_bookmarks")
}

model UserRating {
  id          String    @id @default(uuid())
  userId      String    @map("user_id")
  techniqueId String    @map("technique_id")
  rating      Int       @default(0)
  notes       String?
  workingOn   Boolean   @default(false) @map("working_on")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  technique   Technique @relation(fields: [techniqueId], references: [id], onDelete: Cascade)

  @@unique([userId, techniqueId])
  @@index([userId])
  @@index([techniqueId])
  @@map("user_ratings")
}

model TechniqueNote {
  id          String    @id @default(uuid())
  userId      String    @map("user_id")
  techniqueId String    @map("technique_id")
  content     String
  createdAt   DateTime  @default(now()) @map("created_at")
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  technique   Technique @relation(fields: [techniqueId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([techniqueId])
  @@index([createdAt])
  @@map("technique_notes")
}
